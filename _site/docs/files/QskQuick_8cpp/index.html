<h1 id="controlsqskquickcpp">controls/QskQuick.cpp</h1>

<h2 id="functions">Functions</h2>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>QSizeF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskitemsize">qskItemSize</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>QRectF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskitemrect">qskItemRect</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>QRectF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskitemgeometry">qskItemGeometry</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsksetitemgeometry">qskSetItemGeometry</a></strong>(QQuickItem * item, const QRectF &amp; rect)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisitemcomplete">qskIsItemComplete</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisancestorof">qskIsAncestorOf</a></strong>(const QQuickItem * item, const QQuickItem * child)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisvisibletoparent">qskIsVisibleToParent</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisvisibleto">qskIsVisibleTo</a></strong>(const QQuickItem * item, const QQuickItem * ancestor)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskistabfence">qskIsTabFence</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskispolishscheduled">qskIsPolishScheduled</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisshortcutscope">qskIsShortcutScope</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsksettransparentforpositioner">qskSetTransparentForPositioner</a></strong>(QQuickItem * item, bool on)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskistransparentforpositioner">qskIsTransparentForPositioner</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskisvisibletolayout">qskIsVisibleToLayout</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>QskSizePolicy</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsksizepolicy">qskSizePolicy</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>Qt::Alignment</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsklayoutalignmenthint">qskLayoutAlignmentHint</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskretainsizewhenhidden">qskRetainSizeWhenHidden</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>QQuickItem *</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsknearestfocusscope">qskNearestFocusScope</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskforceactivefocus">qskForceActiveFocus</a></strong>(QQuickItem * item, Qt::FocusReason reason)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskupdateinputmethod">qskUpdateInputMethod</a></strong>(const QQuickItem * item, Qt::InputMethodQueries queries)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskinputmethodsetvisible">qskInputMethodSetVisible</a></strong>(const QQuickItem * item, bool on)</td>
    </tr>
    <tr>
      <td>QList&lt; QQuickItem * &gt;</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskpaintorderchilditems">qskPaintOrderChildItems</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>const QSGNode *</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskitemnode">qskItemNode</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>const QSGNode *</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskpaintnode">qskPaintNode</a></strong>(const QQuickItem * item)</td>
    </tr>
    <tr>
      <td>QSizeF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskeffectivesizehint">qskEffectiveSizeHint</a></strong>(const QQuickItem * item, Qt::SizeHint whichHint, const QSizeF &amp; constraint)</td>
    </tr>
    <tr>
      <td>QSizeF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskboundedconstraint">qskBoundedConstraint</a></strong>(const QQuickItem * item, const QSizeF &amp; constraint, QskSizePolicy policy)</td>
    </tr>
    <tr>
      <td>QSizeF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qsksizeconstraint">qskSizeConstraint</a></strong>(const QQuickItem * item, Qt::SizeHint which, const QSizeF &amp; constraint)</td>
    </tr>
    <tr>
      <td>QSizeF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskconstraineditemsize">qskConstrainedItemSize</a></strong>(const QQuickItem * item, const QSizeF &amp; size)</td>
    </tr>
    <tr>
      <td>QRectF</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskconstraineditemrect">qskConstrainedItemRect</a></strong>(const QQuickItem * item, const QRectF &amp; rect, Qt::Alignment alignment)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskitemupdaterecursive">qskItemUpdateRecursive</a></strong>(QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskgrabmouse">qskGrabMouse</a></strong>(QQuickItem * item)</td>
    </tr>
    <tr>
      <td>void</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskungrabmouse">qskUngrabMouse</a></strong>(QQuickItem * item)</td>
    </tr>
    <tr>
      <td>bool</td>
      <td><strong><a href="/docs/files/QskQuick_8cpp/#function-qskismousegrabber">qskIsMouseGrabber</a></strong>(const QQuickItem * item)</td>
    </tr>
  </tbody>
</table>

<h2 id="functions-documentation">Functions Documentation</h2>

<h3 id="function-qskitemsize">function qskItemSize</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QSizeF</span> <span class="n">qskItemSize</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskitemrect">function qskItemRect</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QRectF</span> <span class="n">qskItemRect</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskitemgeometry">function qskItemGeometry</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QRectF</span> <span class="n">qskItemGeometry</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsksetitemgeometry">function qskSetItemGeometry</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskSetItemGeometry</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QRectF</span> <span class="o">&amp;</span> <span class="n">rect</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisitemcomplete">function qskIsItemComplete</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsItemComplete</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisancestorof">function qskIsAncestorOf</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsAncestorOf</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">child</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisvisibletoparent">function qskIsVisibleToParent</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsVisibleToParent</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisvisibleto">function qskIsVisibleTo</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsVisibleTo</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">ancestor</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskistabfence">function qskIsTabFence</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsTabFence</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskispolishscheduled">function qskIsPolishScheduled</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsPolishScheduled</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisshortcutscope">function qskIsShortcutScope</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsShortcutScope</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsksettransparentforpositioner">function qskSetTransparentForPositioner</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskSetTransparentForPositioner</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="n">on</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskistransparentforpositioner">function qskIsTransparentForPositioner</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsTransparentForPositioner</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskisvisibletolayout">function qskIsVisibleToLayout</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsVisibleToLayout</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsksizepolicy">function qskSizePolicy</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QskSizePolicy</span> <span class="n">qskSizePolicy</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsklayoutalignmenthint">function qskLayoutAlignmentHint</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="n">qskLayoutAlignmentHint</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskretainsizewhenhidden">function qskRetainSizeWhenHidden</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskRetainSizeWhenHidden</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsknearestfocusscope">function qskNearestFocusScope</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">qskNearestFocusScope</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskforceactivefocus">function qskForceActiveFocus</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskForceActiveFocus</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">FocusReason</span> <span class="n">reason</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskupdateinputmethod">function qskUpdateInputMethod</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskUpdateInputMethod</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">InputMethodQueries</span> <span class="n">queries</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskinputmethodsetvisible">function qskInputMethodSetVisible</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskInputMethodSetVisible</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="n">on</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskpaintorderchilditems">function qskPaintOrderChildItems</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QList</span><span class="o">&lt;</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="n">qskPaintOrderChildItems</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskitemnode">function qskItemNode</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">QSGNode</span> <span class="o">*</span> <span class="n">qskItemNode</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskpaintnode">function qskPaintNode</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">QSGNode</span> <span class="o">*</span> <span class="n">qskPaintNode</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskeffectivesizehint">function qskEffectiveSizeHint</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QSizeF</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">whichHint</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QSizeF</span> <span class="o">&amp;</span> <span class="n">constraint</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskboundedconstraint">function qskBoundedConstraint</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="n">QSizeF</span> <span class="n">qskBoundedConstraint</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QSizeF</span> <span class="o">&amp;</span> <span class="n">constraint</span><span class="p">,</span>
    <span class="n">QskSizePolicy</span> <span class="n">policy</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qsksizeconstraint">function qskSizeConstraint</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QSizeF</span> <span class="n">qskSizeConstraint</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QSizeF</span> <span class="o">&amp;</span> <span class="n">constraint</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskconstraineditemsize">function qskConstrainedItemSize</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QSizeF</span> <span class="n">qskConstrainedItemSize</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QSizeF</span> <span class="o">&amp;</span> <span class="n">size</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskconstraineditemrect">function qskConstrainedItemRect</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QRectF</span> <span class="n">qskConstrainedItemRect</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QRectF</span> <span class="o">&amp;</span> <span class="n">rect</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="n">alignment</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskitemupdaterecursive">function qskItemUpdateRecursive</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskItemUpdateRecursive</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskgrabmouse">function qskGrabMouse</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskGrabMouse</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskungrabmouse">function qskUngrabMouse</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">qskUngrabMouse</span><span class="p">(</span>
    <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="function-qskismousegrabber">function qskIsMouseGrabber</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">qskIsMouseGrabber</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QQuickItem</span> <span class="o">*</span> <span class="n">item</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="source-code">Source code</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/******************************************************************************
 * QSkinny - Copyright (C) 2016 Uwe Rathmann
 * This file may be used under the terms of the QSkinny License, Version 1.0
 *****************************************************************************/</span>

<span class="cp">#include "QskQuick.h"
#include "QskControl.h"
#include "QskFunctions.h"
#include &lt;qquickitem.h&gt;
</span>

<span class="cp">#include &lt;private/qguiapplication_p.h&gt;
#include &lt;private/qquickitem_p.h&gt;
</span>

<span class="cp">#include &lt;qpa/qplatforminputcontext.h&gt;
#include &lt;qpa/qplatformintegration.h&gt;
</span>
<span class="n">QSizeF</span> <span class="nf">qskItemSize</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// obsolete for Qt &gt;= 5.10</span>
    <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">QSizeF</span><span class="p">(</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">height</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">QRectF</span> <span class="nf">qskItemRect</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">QRectF</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">height</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">QRectF</span> <span class="nf">qskItemGeometry</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">QRectF</span><span class="p">(</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">height</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskSetItemGeometry</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRectF</span><span class="o">&amp;</span> <span class="n">rect</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">control</span> <span class="o">=</span> <span class="n">qskControlCast</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">control</span><span class="o">-&gt;</span><span class="n">setGeometry</span><span class="p">(</span> <span class="n">rect</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">setPosition</span><span class="p">(</span> <span class="n">rect</span><span class="p">.</span><span class="n">topLeft</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">setSize</span><span class="p">(</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsItemComplete</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">componentComplete</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsAncestorOf</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">child</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="n">child</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

<span class="cp">#if QT_VERSION &gt;= QT_VERSION_CHECK( 5, 7, 0 )
</span>    <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">isAncestorOf</span><span class="p">(</span> <span class="n">child</span> <span class="p">);</span>
<span class="cp">#else
</span>    <span class="k">while</span> <span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">child</span> <span class="o">==</span> <span class="n">item</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

        <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">parentItem</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsVisibleToParent</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">explicitVisible</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsVisibleTo</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">ancestor</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">ancestor</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">isVisible</span><span class="p">();</span> <span class="c1">// like QWidget::isVisibleTo</span>

    <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">parentItem</span><span class="p">();</span>
        <span class="n">it</span> <span class="o">!=</span> <span class="n">ancestor</span><span class="p">;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">parentItem</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">it</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// ancestor is no parent</span>

        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">it</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">explicitVisible</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsTabFence</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">isTabFence</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsPolishScheduled</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">polishScheduled</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsShortcutScope</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="cm">/*
        We might have something like CTRL+W to close a "window".
        But in Qt/Quick a window is not necessarily a QQuickWindow
        like we have f.e QskSubWindow.

        Maybe it's worth to introduce a shortcutScope flag but for
        the moment we simply use the isFocusScope/isTabFence combination,
        that should usually be set for those "windows".
     */</span>

    <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">isFocusScope</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">isTabFence</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskSetTransparentForPositioner</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">on</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">setTransparentForPositioner</span><span class="p">(</span> <span class="n">on</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsTransparentForPositioner</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">isTransparentForPositioner</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsVisibleToLayout</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">isTransparentForPositioner</span><span class="p">()</span>
            <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">explicitVisible</span> <span class="o">||</span> <span class="n">qskRetainSizeWhenHidden</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QskSizePolicy</span> <span class="nf">qskSizePolicy</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">control</span> <span class="o">=</span> <span class="n">qskControlCast</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">control</span><span class="o">-&gt;</span><span class="n">sizePolicy</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">QVariant</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">property</span><span class="p">(</span> <span class="s">"sizePolicy"</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v</span><span class="p">.</span><span class="n">canConvert</span><span class="o">&lt;</span> <span class="n">QskSizePolicy</span> <span class="o">&gt;</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">qvariant_cast</span><span class="o">&lt;</span> <span class="n">QskSizePolicy</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">v</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">QskSizePolicy</span><span class="p">(</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">Preferred</span><span class="p">,</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">Preferred</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="nf">qskLayoutAlignmentHint</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">control</span> <span class="o">=</span> <span class="n">qskControlCast</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">control</span><span class="o">-&gt;</span><span class="n">layoutAlignmentHint</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">QVariant</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">property</span><span class="p">(</span> <span class="s">"layoutAlignmentHint"</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v</span><span class="p">.</span><span class="n">canConvert</span><span class="o">&lt;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="o">&gt;</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span><span class="p">.</span><span class="n">value</span><span class="o">&lt;</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskRetainSizeWhenHidden</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">control</span> <span class="o">=</span> <span class="n">qskControlCast</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">control</span><span class="o">-&gt;</span><span class="n">layoutHints</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">QskControl</span><span class="o">::</span><span class="n">RetainSizeWhenHidden</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">QVariant</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">property</span><span class="p">(</span> <span class="s">"retainSizeWhenHidden"</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v</span><span class="p">.</span><span class="n">canConvert</span><span class="o">&lt;</span> <span class="kt">bool</span> <span class="o">&gt;</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span><span class="p">.</span><span class="n">value</span><span class="o">&lt;</span> <span class="kt">bool</span> <span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QQuickItem</span><span class="o">*</span> <span class="nf">qskNearestFocusScope</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">parentItem</span><span class="p">();</span>
            <span class="n">scope</span> <span class="o">!=</span> <span class="nb">nullptr</span><span class="p">;</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">scope</span><span class="o">-&gt;</span><span class="n">parentItem</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">scope</span><span class="o">-&gt;</span><span class="n">isFocusScope</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">scope</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/*
            As the default setting of the root item is to be a focus scope
            we usually never get here - beside the flag has been explicitely
            disabled in application code.
         */</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskForceActiveFocus</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">FocusReason</span> <span class="n">reason</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*
        For unknown reasons Qt::PopupFocusReason is blocked inside of
        QQuickItem::setFocus and so we can't use QQuickItem::forceActiveFocus
     */</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>


<span class="cp">#if QT_VERSION &gt;= QT_VERSION_CHECK( 6, 1, 0 )
</span>    <span class="k">auto</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">deliveryAgentPrivate</span><span class="p">();</span>
<span class="cp">#else
</span>    <span class="k">auto</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">QQuickWindowPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span> <span class="p">);</span>
<span class="cp">#endif
</span>    <span class="k">while</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">qskNearestFocusScope</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">wp</span><span class="o">-&gt;</span><span class="n">setFocusInScope</span><span class="p">(</span> <span class="n">scope</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">reason</span> <span class="p">);</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">scope</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskUpdateInputMethod</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">InputMethodQueries</span> <span class="n">queries</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">QQuickItem</span><span class="o">::</span><span class="n">ItemAcceptsInputMethod</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">QPlatformInputContext</span><span class="o">*</span> <span class="n">context</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">methodId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="cm">/*
        We could also get the inputContext from QInputMethodPrivate
        but for some reason the gcc sanitizer reports errors
        when using it. So let's go with QGuiApplicationPrivate.
     */</span>

    <span class="k">auto</span> <span class="n">inputContext</span> <span class="o">=</span> <span class="n">QGuiApplicationPrivate</span><span class="o">::</span><span class="n">platformIntegration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">inputContext</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">inputContext</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
        <span class="n">methodId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">inputContext</span> <span class="o">!=</span> <span class="n">context</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">inputContext</span><span class="p">;</span>
        <span class="n">methodId</span> <span class="o">=</span> <span class="n">inputContext</span><span class="o">-&gt;</span><span class="n">metaObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">indexOfMethod</span><span class="p">(</span>
            <span class="s">"update(const QQuickItem*,Qt::InputMethodQueries)"</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">methodId</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*
            The protocol for input methods does not fit well for a
            virtual keyboard as it is tied to the focus.
            So we try to bypass QInputMethod calling the
            inputContext directly.
         */</span>

        <span class="k">const</span> <span class="k">auto</span> <span class="n">method</span> <span class="o">=</span> <span class="n">inputContext</span><span class="o">-&gt;</span><span class="n">metaObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">(</span> <span class="n">methodId</span> <span class="p">);</span>
        <span class="n">method</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span> <span class="n">inputContext</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DirectConnection</span><span class="p">,</span>
            <span class="n">Q_ARG</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span><span class="p">,</span> <span class="n">item</span> <span class="p">),</span> <span class="n">Q_ARG</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">InputMethodQueries</span><span class="p">,</span> <span class="n">queries</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">QGuiApplication</span><span class="o">::</span><span class="n">inputMethod</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span> <span class="n">queries</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskInputMethodSetVisible</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">on</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">QPlatformInputContext</span><span class="o">*</span> <span class="n">context</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">methodId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">auto</span> <span class="n">inputContext</span> <span class="o">=</span> <span class="n">QGuiApplicationPrivate</span><span class="o">::</span><span class="n">platformIntegration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">inputContext</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">inputContext</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
        <span class="n">methodId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">inputContext</span> <span class="o">!=</span> <span class="n">context</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">inputContext</span><span class="p">;</span>
        <span class="n">methodId</span> <span class="o">=</span> <span class="n">inputContext</span><span class="o">-&gt;</span><span class="n">metaObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">indexOfMethod</span><span class="p">(</span>
            <span class="s">"setInputPanelVisible(const QQuickItem*,bool)"</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">methodId</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">method</span> <span class="o">=</span> <span class="n">inputContext</span><span class="o">-&gt;</span><span class="n">metaObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">(</span> <span class="n">methodId</span> <span class="p">);</span>
        <span class="n">method</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span> <span class="n">inputContext</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">DirectConnection</span><span class="p">,</span>
            <span class="n">Q_ARG</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span><span class="p">,</span> <span class="n">item</span> <span class="p">),</span> <span class="n">Q_ARG</span><span class="p">(</span> <span class="kt">bool</span><span class="p">,</span> <span class="n">on</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">on</span> <span class="p">)</span>
            <span class="n">QGuiApplication</span><span class="o">::</span><span class="n">inputMethod</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">show</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="n">QGuiApplication</span><span class="o">::</span><span class="n">inputMethod</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">hide</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">QList</span><span class="o">&lt;</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">qskPaintOrderChildItems</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">paintOrderChildItems</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">QList</span><span class="o">&lt;</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">const</span> <span class="n">QSGNode</span><span class="o">*</span> <span class="nf">qskItemNode</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">itemNodeInstance</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="n">QSGNode</span><span class="o">*</span> <span class="nf">qskPaintNode</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">paintNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QSizeF</span> <span class="nf">qskEffectiveSizeHint</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">whichHint</span><span class="p">,</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">constraint</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">control</span> <span class="o">=</span> <span class="n">qskControlCast</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">control</span><span class="o">-&gt;</span><span class="n">effectiveSizeHint</span><span class="p">(</span> <span class="n">whichHint</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="o">||</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// QQuickItem does not support dynamic constraints</span>
        <span class="k">return</span> <span class="n">constraint</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QSizeF</span><span class="p">();</span>

    <span class="cm">/*
        Trying to retrieve something useful for non QskControls:

        First are checking some properties, that usually match the
        names for the explicit hints. For the implicit hints we only
        have the implicitSize, what is interpreted as the implicit
        preferred size.
     */</span>
    <span class="n">QSizeF</span> <span class="n">hint</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">properties</span><span class="p">[]</span> <span class="o">=</span>
    <span class="p">{</span>
        <span class="s">"minimumSize"</span><span class="p">,</span>
        <span class="s">"preferredSize"</span><span class="p">,</span>
        <span class="s">"maximumSize"</span>
    <span class="p">};</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">property</span><span class="p">(</span> <span class="n">properties</span><span class="p">[</span> <span class="n">whichHint</span> <span class="p">]</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v</span><span class="p">.</span><span class="n">canConvert</span><span class="o">&lt;</span> <span class="n">QSizeF</span> <span class="o">&gt;</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">toSizeF</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">whichHint</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">PreferredSize</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">hint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">hint</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">implicitWidth</span><span class="p">()</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">hint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">hint</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">implicitHeight</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">hint</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">QSizeF</span> <span class="nf">qskBoundedConstraint</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">QskSizePolicy</span> <span class="n">policy</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Vertical</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">constraint</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">whichMin</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">effectiveSizeHintType</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MinimumSize</span><span class="p">,</span> <span class="n">orientation</span> <span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">whichMax</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">effectiveSizeHintType</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MaximumSize</span><span class="p">,</span> <span class="n">orientation</span> <span class="p">);</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">hintMin</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichMin</span> <span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">hintMax</span> <span class="o">=</span> <span class="p">(</span> <span class="n">whichMax</span> <span class="o">==</span> <span class="n">whichMin</span> <span class="p">)</span>
        <span class="o">?</span> <span class="n">hintMin</span> <span class="o">:</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichMax</span> <span class="p">);</span>

    <span class="n">QSizeF</span> <span class="n">size</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">hintMax</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
            <span class="n">size</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">hintMax</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>

        <span class="n">size</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">hintMin</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">hintMax</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
            <span class="n">size</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">hintMax</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">);</span>

        <span class="n">size</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">hintMin</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QSizeF</span> <span class="nf">qskSizeConstraint</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">constraint</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QSizeF</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">isValid</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">constraint</span><span class="p">;</span>

    <span class="k">auto</span> <span class="n">policy</span> <span class="o">=</span> <span class="n">qskSizePolicy</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>

    <span class="kt">bool</span> <span class="n">ignoreWidth</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">ignoreHeight</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">which</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">PreferredSize</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*
            First we are checking the IgnoreFlag, to avoid doing
            pointless calculations.
         */</span>
        <span class="n">ignoreWidth</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">policy</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">IgnoreFlag</span><span class="p">;</span>
        <span class="n">ignoreHeight</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">policy</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Vertical</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">IgnoreFlag</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ignoreWidth</span> <span class="o">&amp;&amp;</span> <span class="n">ignoreHeight</span> <span class="p">)</span>
            <span class="o">||</span> <span class="p">(</span> <span class="n">ignoreWidth</span> <span class="o">&amp;&amp;</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
            <span class="o">||</span> <span class="p">(</span> <span class="n">ignoreHeight</span> <span class="o">&amp;&amp;</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">QSizeF</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">whichH</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">effectiveSizeHintType</span><span class="p">(</span> <span class="n">which</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">whichV</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">effectiveSizeHintType</span><span class="p">(</span> <span class="n">which</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Vertical</span> <span class="p">);</span>

    <span class="n">QSizeF</span> <span class="n">size</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">constraintType</span> <span class="o">=</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">Unconstrained</span><span class="p">;</span>

    <span class="cm">/*
        We apply a constraint - even, when the policy is unconstrained.
        Do we really want to do this ???
     */</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="n">qskBoundedConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">policy</span> <span class="p">);</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichV</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">whichH</span> <span class="o">!=</span> <span class="n">whichV</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">constraintType</span> <span class="o">=</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">WidthForHeight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="n">qskBoundedConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">policy</span> <span class="p">);</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichH</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">whichV</span> <span class="o">!=</span> <span class="n">whichH</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">constraintType</span> <span class="o">=</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">HeightForWidth</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">constraintType</span> <span class="o">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">constraintType</span><span class="p">();</span>

        <span class="k">switch</span><span class="p">(</span> <span class="n">constraintType</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">WidthForHeight</span><span class="p">:</span>
            <span class="p">{</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichV</span> <span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">HeightForWidth</span><span class="p">:</span>
            <span class="p">{</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichH</span> <span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nl">default:</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">whichV</span> <span class="o">!=</span> <span class="n">whichH</span> <span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">ignoreWidth</span> <span class="p">)</span>
                        <span class="n">size</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichH</span> <span class="p">).</span><span class="n">width</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">ignoreHeight</span> <span class="p">)</span>
                        <span class="n">size</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichV</span> <span class="p">).</span><span class="n">height</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichH</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">constraintType</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">HeightForWidth</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="n">QSizeF</span> <span class="n">c</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="o">-</span><span class="mf">1.0</span> <span class="p">);</span>
            <span class="n">size</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichV</span><span class="p">,</span> <span class="n">c</span> <span class="p">).</span><span class="n">height</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">WidthForHeight</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="n">QSizeF</span> <span class="n">c</span><span class="p">(</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">);</span>
            <span class="n">size</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">qskEffectiveSizeHint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">whichH</span><span class="p">,</span> <span class="n">c</span> <span class="p">).</span><span class="n">width</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">ignoreWidth</span> <span class="o">||</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="n">size</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">ignoreHeight</span> <span class="o">||</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="n">size</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QSizeF</span> <span class="nf">qskConstrainedItemSize</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">size</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="o">&amp;&amp;</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">QSizeF</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">);</span>

    <span class="n">QSizeF</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">;</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">policy</span> <span class="o">=</span> <span class="n">qskSizePolicy</span><span class="p">(</span> <span class="n">item</span> <span class="p">);</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">policy</span><span class="p">.</span><span class="n">constraintType</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">WidthForHeight</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">constraint</span> <span class="o">=</span> <span class="n">qskBoundedConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span>
                <span class="n">QSizeF</span><span class="p">(</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">),</span> <span class="n">policy</span> <span class="p">);</span>

            <span class="n">min</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MinimumSize</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MaximumSize</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>

            <span class="n">min</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">max</span><span class="p">.</span><span class="n">rheight</span><span class="p">()</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">.</span><span class="n">height</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">HeightForWidth</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">constraint</span> <span class="o">=</span> <span class="n">qskBoundedConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span>
                <span class="n">QSizeF</span><span class="p">(</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="o">-</span><span class="mf">1.0</span> <span class="p">),</span> <span class="n">policy</span> <span class="p">);</span>

            <span class="n">min</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MinimumSize</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MaximumSize</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>

            <span class="n">min</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">max</span><span class="p">.</span><span class="n">rwidth</span><span class="p">()</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">.</span><span class="n">width</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nl">default:</span>
        <span class="p">{</span>
            <span class="n">min</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MinimumSize</span><span class="p">,</span> <span class="n">QSizeF</span><span class="p">()</span> <span class="p">);</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">qskSizeConstraint</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">MaximumSize</span><span class="p">,</span> <span class="n">QSizeF</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">qreal</span> <span class="n">width</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">();</span>
    <span class="n">qreal</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">max</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span> <span class="n">width</span><span class="p">,</span> <span class="n">max</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">max</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">qMin</span><span class="p">(</span> <span class="n">height</span><span class="p">,</span> <span class="n">max</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">);</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">width</span><span class="p">,</span> <span class="n">min</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">height</span><span class="p">,</span> <span class="n">min</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="p">);</span>

    <span class="k">return</span> <span class="n">QSizeF</span><span class="p">(</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">QRectF</span> <span class="nf">qskConstrainedItemRect</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QRectF</span><span class="o">&amp;</span> <span class="n">rect</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Alignment</span> <span class="n">alignment</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">qskConstrainedItemSize</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">qskAlignedRectF</span><span class="p">(</span> <span class="n">rect</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">alignment</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskItemUpdateRecursive</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">QQuickItem</span><span class="o">::</span><span class="n">ItemHasContents</span> <span class="p">)</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">();</span>

    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">QQuickItemPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">childItems</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span> <span class="p">)</span>
        <span class="n">qskItemUpdateRecursive</span><span class="p">(</span> <span class="n">child</span> <span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if QT_VERSION &gt;= QT_VERSION_CHECK( 5, 8, 0 ) &amp;&amp; QT_VERSION &lt; QT_VERSION_CHECK( 6, 0, 0 )
</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">QQuickPointerTouchEvent</span><span class="o">*</span> <span class="nf">qskPointerPressEvent</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickWindowPrivate</span><span class="o">*</span> <span class="n">wd</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">event</span> <span class="o">:</span> <span class="n">wd</span><span class="o">-&gt;</span><span class="n">pointerEventInstances</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">touchEvent</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">asPointerTouchEvent</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">touchEvent</span><span class="o">-&gt;</span><span class="n">isPressEvent</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">touchEvent</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif
</span>
<span class="kt">bool</span> <span class="nf">qskGrabMouse</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">mouseGrabber</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mouseGrabberItem</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">mouseGrabber</span> <span class="o">==</span> <span class="n">item</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">mouseGrabber</span><span class="o">-&gt;</span><span class="n">keepMouseGrab</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// we respect this</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">item</span><span class="o">-&gt;</span><span class="n">setKeepMouseGrab</span><span class="p">(</span> <span class="nb">true</span> <span class="p">);</span>

<span class="cp">#if QT_VERSION &gt;= QT_VERSION_CHECK( 5, 8, 0 ) &amp;&amp; QT_VERSION &lt; QT_VERSION_CHECK( 6, 0, 0 )
</span>
    <span class="k">auto</span> <span class="n">wd</span> <span class="o">=</span> <span class="n">QQuickWindowPrivate</span><span class="o">::</span><span class="n">get</span><span class="p">(</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">wd</span><span class="o">-&gt;</span><span class="n">touchMouseDevice</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*
            For synthesized mouse events QQuickWindow sends
            an initial QEvent::MouseButtonPress before setting
            touchMouseDevice/touchMouseId. As the mouse grabber is
            stored depending on these attributes the following
            mouse event callbacks will look for the grabber at a
            a different place as it was stored.
         */</span>

        <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">event</span> <span class="o">=</span> <span class="n">qskPointerPressEvent</span><span class="p">(</span> <span class="n">wd</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">point</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">wd</span><span class="o">-&gt;</span><span class="n">touchMouseDevice</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">();</span>
                <span class="n">wd</span><span class="o">-&gt;</span><span class="n">touchMouseId</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">pointId</span><span class="p">();</span>

                <span class="n">item</span><span class="o">-&gt;</span><span class="n">grabMouse</span><span class="p">();</span>

                <span class="n">wd</span><span class="o">-&gt;</span><span class="n">touchMouseDevice</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
                <span class="n">wd</span><span class="o">-&gt;</span><span class="n">touchMouseId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">#endif
</span>
    <span class="n">item</span><span class="o">-&gt;</span><span class="n">grabMouse</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">qskUngrabMouse</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">setKeepMouseGrab</span><span class="p">(</span> <span class="nb">false</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">qskIsMouseGrabber</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">item</span><span class="o">-&gt;</span><span class="n">ungrabMouse</span><span class="p">();</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">qskIsMouseGrabber</span><span class="p">(</span> <span class="k">const</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">window</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">mouseGrabberItem</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<p>Updated on 28 July 2023 at 14:02:29 CEST</p>
