<h1 id="layoutsqskgridlayoutenginecpp">layouts/QskGridLayoutEngine.cpp</h1>

<h2 id="functions">Functions</h2>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>qreal</td>
      <td><strong><a href="/docs/files/QskGridLayoutEngine_8cpp/#function-qsksegmentlength">qskSegmentLength</a></strong>(const QskLayoutChain::Segments &amp; s, int start, int end)</td>
    </tr>
  </tbody>
</table>

<h2 id="functions-documentation">Functions Documentation</h2>

<h3 id="function-qsksegmentlength">function qskSegmentLength</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kr">inline</span> <span class="n">qreal</span> <span class="n">qskSegmentLength</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">Segments</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">start</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">end</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="source-code">Source code</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/******************************************************************************
 * QSkinny - Copyright (C) 2016 Uwe Rathmann
 * This file may be used under the terms of the QSkinny License, Version 1.0
 *****************************************************************************/</span>

<span class="cp">#include "QskGridLayoutEngine.h"
#include "QskLayoutHint.h"
#include "QskLayoutChain.h"
#include "QskSizePolicy.h"
#include "QskQuick.h"
</span>
<span class="cp">#include &lt;qvector.h&gt;
</span>
<span class="cp">#include &lt;vector&gt;
#include &lt;functional&gt;
</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">qreal</span> <span class="nf">qskSegmentLength</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">Segments</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">end</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[</span> <span class="n">end</span> <span class="p">].</span><span class="n">start</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span> <span class="n">start</span> <span class="p">].</span><span class="n">start</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span> <span class="n">end</span> <span class="p">].</span><span class="n">length</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">namespace</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Settings</span>
    <span class="p">{</span>
      <span class="nl">public:</span>
        <span class="k">class</span> <span class="nc">Setting</span>
        <span class="p">{</span>
          <span class="nl">public:</span>
            <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">isDefault</span><span class="p">()</span> <span class="k">const</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">m_stretch</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">m_hint</span><span class="p">.</span><span class="n">isDefault</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="kt">bool</span> <span class="n">setStretch</span><span class="p">(</span> <span class="kt">int</span> <span class="n">stretch</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">stretch</span> <span class="o">!=</span> <span class="n">m_stretch</span> <span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">m_stretch</span> <span class="o">=</span> <span class="n">stretch</span><span class="p">;</span>
                    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">bool</span> <span class="n">setHint</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span> <span class="n">qreal</span> <span class="n">size</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">m_hint</span><span class="p">.</span><span class="n">size</span><span class="p">(</span> <span class="n">which</span> <span class="p">)</span> <span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">m_hint</span><span class="p">.</span><span class="n">setSize</span><span class="p">(</span> <span class="n">which</span><span class="p">,</span> <span class="n">size</span> <span class="p">);</span>
                    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">CellData</span> <span class="n">cell</span><span class="p">()</span> <span class="k">const</span>
            <span class="p">{</span>
                <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">CellData</span> <span class="n">cell</span><span class="p">;</span>
                <span class="n">cell</span><span class="p">.</span><span class="n">hint</span> <span class="o">=</span> <span class="n">m_hint</span><span class="p">.</span><span class="n">normalized</span><span class="p">();</span>
                <span class="n">cell</span><span class="p">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="n">m_stretch</span><span class="p">;</span>
                <span class="n">cell</span><span class="p">.</span><span class="n">canGrow</span> <span class="o">=</span> <span class="n">m_stretch</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">cell</span><span class="p">.</span><span class="n">isValid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

                <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kr">inline</span> <span class="kt">int</span> <span class="n">stretch</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_stretch</span><span class="p">;</span> <span class="p">}</span>
            <span class="kr">inline</span> <span class="n">QskLayoutHint</span> <span class="n">hint</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_hint</span><span class="p">;</span> <span class="p">}</span>

            <span class="kt">int</span> <span class="n">position</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

          <span class="nl">private:</span>
            <span class="kt">int</span> <span class="n">m_stretch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">QskLayoutHint</span> <span class="n">m_hint</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="kt">int</span> <span class="n">maxPosition</span><span class="p">()</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">m_settings</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">m_settings</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">position</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">clear</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">m_settings</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">setStretchAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stretch</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">setStretch</span> <span class="o">=</span> <span class="p">[</span><span class="n">stretch</span><span class="p">](</span> <span class="n">Setting</span><span class="o">&amp;</span> <span class="n">s</span> <span class="p">)</span>
                <span class="p">{</span> <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">setStretch</span><span class="p">(</span> <span class="n">stretch</span> <span class="p">);</span> <span class="p">};</span>

            <span class="k">return</span> <span class="n">setValueAt</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">setStretch</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">setHintAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span> <span class="n">qreal</span> <span class="n">size</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">setHint</span> <span class="o">=</span> <span class="p">[</span><span class="n">which</span><span class="p">,</span> <span class="n">size</span><span class="p">](</span> <span class="n">Setting</span><span class="o">&amp;</span> <span class="n">s</span> <span class="p">)</span>
                <span class="p">{</span> <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">setHint</span><span class="p">(</span> <span class="n">which</span><span class="p">,</span> <span class="n">size</span> <span class="p">);</span> <span class="p">};</span>

            <span class="k">return</span> <span class="n">setValueAt</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">setHint</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Setting</span> <span class="n">settingAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">lowerBound</span><span class="p">(</span> <span class="n">index</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">m_settings</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span> <span class="o">*</span><span class="n">it</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">Setting</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Setting</span> <span class="o">&gt;&amp;</span> <span class="n">settings</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_settings</span><span class="p">;</span> <span class="p">}</span>

      <span class="nl">private:</span>
        <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">setValueAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span> <span class="kt">bool</span><span class="p">(</span> <span class="n">Setting</span><span class="o">&amp;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">modify</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

            <span class="kt">bool</span> <span class="n">isModified</span><span class="p">;</span>

            <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">lowerBound</span><span class="p">(</span> <span class="n">pos</span> <span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">m_settings</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">isModified</span> <span class="o">=</span> <span class="n">modify</span><span class="p">(</span> <span class="o">*</span><span class="n">it</span> <span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">isModified</span> <span class="o">&amp;&amp;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">isDefault</span><span class="p">()</span> <span class="p">)</span>
                    <span class="n">m_settings</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span> <span class="n">it</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Setting</span> <span class="n">setting</span><span class="p">;</span>
                <span class="n">isModified</span> <span class="o">=</span> <span class="n">modify</span><span class="p">(</span> <span class="n">setting</span> <span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">isModified</span> <span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">setting</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
                    <span class="n">m_settings</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">it</span><span class="p">,</span> <span class="n">setting</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">isModified</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Setting</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">lowerBound</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">cmp</span> <span class="o">=</span> <span class="p">[](</span> <span class="k">const</span> <span class="n">Setting</span><span class="o">&amp;</span> <span class="n">setting</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">pos</span> <span class="p">)</span>
                <span class="p">{</span> <span class="k">return</span> <span class="n">setting</span><span class="p">.</span><span class="n">position</span> <span class="o">&lt;</span> <span class="n">pos</span><span class="p">;</span> <span class="p">};</span>

            <span class="k">auto</span><span class="o">&amp;</span> <span class="n">settings</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Setting</span> <span class="o">&gt;&amp;</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">m_settings</span> <span class="p">);</span>
            <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">lower_bound</span><span class="p">(</span> <span class="n">settings</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">settings</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">index</span><span class="p">,</span> <span class="n">cmp</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Setting</span> <span class="o">&gt;</span> <span class="n">m_settings</span><span class="p">;</span> <span class="c1">// a flat map</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">namespace</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Element</span>
    <span class="p">{</span>
      <span class="nl">public:</span>
        <span class="n">Element</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="p">);</span>
        <span class="n">Element</span><span class="p">(</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">spacing</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="p">);</span>
        <span class="n">Element</span><span class="p">(</span> <span class="k">const</span> <span class="n">Element</span><span class="o">&amp;</span> <span class="p">);</span>

        <span class="n">Element</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span> <span class="k">const</span> <span class="n">Element</span><span class="o">&amp;</span> <span class="p">);</span>

        <span class="n">QSizeF</span> <span class="n">spacing</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
        <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

        <span class="n">QRect</span> <span class="n">grid</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
        <span class="kt">void</span> <span class="n">setGrid</span><span class="p">(</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="p">);</span>

        <span class="n">QRect</span> <span class="n">minimumGrid</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

        <span class="kt">bool</span> <span class="n">isIgnored</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
        <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">CellData</span> <span class="n">cell</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="p">)</span> <span class="k">const</span><span class="p">;</span>

        <span class="kt">void</span> <span class="n">transpose</span><span class="p">();</span>

      <span class="nl">private:</span>

        <span class="k">union</span>
        <span class="p">{</span>
            <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">m_item</span><span class="p">;</span>
            <span class="n">QSizeF</span> <span class="n">m_spacing</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="n">QRect</span> <span class="n">m_grid</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">m_isSpacer</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="n">Element</span><span class="o">::</span><span class="n">Element</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
    <span class="o">:</span> <span class="n">m_item</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
    <span class="p">,</span> <span class="n">m_grid</span><span class="p">(</span> <span class="n">grid</span> <span class="p">)</span>
    <span class="p">,</span> <span class="n">m_isSpacer</span><span class="p">(</span> <span class="nb">false</span> <span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">Element</span><span class="o">::</span><span class="n">Element</span><span class="p">(</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">spacing</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
    <span class="o">:</span> <span class="n">m_spacing</span><span class="p">(</span> <span class="n">spacing</span> <span class="p">)</span>
    <span class="p">,</span> <span class="n">m_grid</span><span class="p">(</span> <span class="n">grid</span> <span class="p">)</span>
    <span class="p">,</span> <span class="n">m_isSpacer</span><span class="p">(</span> <span class="nb">true</span> <span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">Element</span><span class="o">::</span><span class="n">Element</span><span class="p">(</span> <span class="k">const</span> <span class="n">Element</span><span class="o">&amp;</span> <span class="n">other</span> <span class="p">)</span>
    <span class="o">:</span> <span class="n">m_grid</span><span class="p">(</span> <span class="n">other</span><span class="p">.</span><span class="n">m_grid</span> <span class="p">)</span>
    <span class="p">,</span> <span class="n">m_isSpacer</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">m_isSpacer</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">other</span><span class="p">.</span><span class="n">m_isSpacer</span> <span class="p">)</span>
        <span class="n">m_spacing</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_spacing</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">m_item</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_item</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Element</span><span class="o">&amp;</span> <span class="n">Element</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span> <span class="k">const</span> <span class="n">Element</span><span class="o">&amp;</span> <span class="n">other</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_isSpacer</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_isSpacer</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">other</span><span class="p">.</span><span class="n">m_isSpacer</span> <span class="p">)</span>
        <span class="n">m_spacing</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_spacing</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">m_item</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_item</span><span class="p">;</span>

    <span class="n">m_grid</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">m_grid</span><span class="p">;</span>

    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">QSizeF</span> <span class="n">Element</span><span class="o">::</span><span class="n">spacing</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_isSpacer</span> <span class="o">?</span> <span class="n">m_spacing</span> <span class="o">:</span> <span class="n">QSizeF</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">Element</span><span class="o">::</span><span class="n">item</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_isSpacer</span> <span class="o">?</span> <span class="nb">nullptr</span> <span class="o">:</span> <span class="n">m_item</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QRect</span> <span class="n">Element</span><span class="o">::</span><span class="n">grid</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_grid</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Element</span><span class="o">::</span><span class="n">setGrid</span><span class="p">(</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_grid</span> <span class="o">=</span> <span class="n">grid</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QRect</span> <span class="n">Element</span><span class="o">::</span><span class="n">minimumGrid</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">QRect</span><span class="p">(</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">top</span><span class="p">(),</span>
        <span class="n">qMax</span><span class="p">(</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="mi">1</span> <span class="p">),</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Element</span><span class="o">::</span><span class="n">isIgnored</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span> <span class="n">m_isSpacer</span> <span class="o">||</span> <span class="n">qskIsVisibleToLayout</span><span class="p">(</span> <span class="n">m_item</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">CellData</span> <span class="n">Element</span><span class="o">::</span><span class="n">cell</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">CellData</span> <span class="n">cell</span><span class="p">;</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">isValid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">m_isSpacer</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">qreal</span> <span class="n">value</span> <span class="o">=</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
            <span class="o">?</span> <span class="n">m_spacing</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_spacing</span><span class="p">.</span><span class="n">height</span><span class="p">();</span>

        <span class="n">cell</span><span class="p">.</span><span class="n">hint</span><span class="p">.</span><span class="n">setMinimum</span><span class="p">(</span> <span class="n">value</span> <span class="p">);</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">hint</span><span class="p">.</span><span class="n">setPreferred</span><span class="p">(</span> <span class="n">value</span> <span class="p">);</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">hint</span><span class="p">.</span><span class="n">setMaximum</span><span class="p">(</span> <span class="n">value</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">policy</span> <span class="o">=</span> <span class="n">qskSizePolicy</span><span class="p">(</span> <span class="n">m_item</span> <span class="p">).</span><span class="n">policy</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">);</span>

        <span class="n">cell</span><span class="p">.</span><span class="n">canGrow</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">&amp;</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">GrowFlag</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">policy</span> <span class="o">&amp;</span> <span class="n">QskSizePolicy</span><span class="o">::</span><span class="n">ExpandFlag</span> <span class="p">)</span>
            <span class="n">cell</span><span class="p">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Element</span><span class="o">::</span><span class="n">transpose</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_grid</span><span class="p">.</span><span class="n">setRect</span><span class="p">(</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">top</span><span class="p">(),</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">left</span><span class="p">(),</span>
        <span class="n">m_grid</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">m_grid</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">QskGridLayoutEngine</span><span class="o">::</span><span class="n">PrivateData</span>
<span class="p">{</span>
  <span class="nl">public:</span>
    <span class="kr">inline</span> <span class="n">Element</span><span class="o">*</span> <span class="n">elementAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">count</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>

        <span class="k">return</span> <span class="k">const_cast</span><span class="o">&lt;</span> <span class="n">Element</span><span class="o">*</span> <span class="o">&gt;</span><span class="p">(</span> <span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">insertElement</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="n">QSizeF</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">QRect</span> <span class="n">grid</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// -1 means unlimited, while 0 does not make any sense</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">grid</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">grid</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">Element</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">grid</span> <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">spacing</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span>
                <span class="n">spacing</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span> <span class="mf">0.0</span> <span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">spacing</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span>
                <span class="n">spacing</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span> <span class="mf">0.0</span> <span class="p">);</span>

            <span class="n">elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">Element</span><span class="p">(</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">grid</span> <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">effectiveGrid</span><span class="p">(</span> <span class="n">elements</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="p">);</span>

        <span class="n">rowCount</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">rowCount</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="n">columnCount</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">columnCount</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">right</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">QRect</span> <span class="n">effectiveGrid</span><span class="p">(</span> <span class="k">const</span> <span class="n">Element</span><span class="o">&amp;</span> <span class="n">element</span> <span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">QRect</span> <span class="n">r</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">grid</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">r</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">r</span><span class="p">.</span><span class="n">setRight</span><span class="p">(</span> <span class="n">qMax</span><span class="p">(</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">left</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">r</span><span class="p">.</span><span class="n">setBottom</span><span class="p">(</span> <span class="n">qMax</span><span class="p">(</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>

        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Settings</span><span class="o">&amp;</span> <span class="n">settings</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span> <span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">that</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span> <span class="n">PrivateData</span><span class="o">*</span> <span class="o">&gt;</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
            <span class="o">?</span> <span class="n">that</span><span class="o">-&gt;</span><span class="n">columnSettings</span> <span class="o">:</span> <span class="n">that</span><span class="o">-&gt;</span><span class="n">rowSettings</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Element</span> <span class="o">&gt;</span> <span class="n">elements</span><span class="p">;</span>

    <span class="n">Settings</span> <span class="n">rowSettings</span><span class="p">;</span>
    <span class="n">Settings</span> <span class="n">columnSettings</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">columnCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">QskGridLayoutEngine</span><span class="p">()</span>
    <span class="o">:</span> <span class="n">m_data</span><span class="p">(</span> <span class="k">new</span> <span class="nf">PrivateData</span><span class="p">()</span> <span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">QskGridLayoutEngine</span><span class="o">::~</span><span class="n">QskGridLayoutEngine</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">count</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">setStretchFactor</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">stretch</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">m_data</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">).</span><span class="n">setStretchAt</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="n">stretch</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="p">)</span>
            <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="p">)</span>
            <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">stretchFactor</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">setting</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">).</span><span class="n">settingAt</span><span class="p">(</span> <span class="n">pos</span> <span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">setting</span><span class="p">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span> <span class="p">)</span> <span class="o">?</span> <span class="n">setting</span><span class="p">.</span><span class="n">stretch</span><span class="p">()</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">setRowSizeHint</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span> <span class="n">qreal</span> <span class="n">height</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowSettings</span><span class="p">.</span><span class="n">setHintAt</span><span class="p">(</span> <span class="n">row</span><span class="p">,</span> <span class="n">which</span><span class="p">,</span> <span class="n">height</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="p">)</span>
        <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">qreal</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">rowSizeHint</span><span class="p">(</span> <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowSettings</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">settings</span><span class="p">.</span><span class="n">settingAt</span><span class="p">(</span> <span class="n">row</span> <span class="p">).</span><span class="n">hint</span><span class="p">().</span><span class="n">size</span><span class="p">(</span> <span class="n">which</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">setColumnSizeHint</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span><span class="p">,</span> <span class="n">qreal</span> <span class="n">width</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnSettings</span><span class="p">.</span><span class="n">setHintAt</span><span class="p">(</span> <span class="n">column</span><span class="p">,</span> <span class="n">which</span><span class="p">,</span> <span class="n">width</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">column</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="p">)</span>
        <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="o">=</span> <span class="n">column</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">qreal</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">columnSizeHint</span><span class="p">(</span> <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">SizeHint</span> <span class="n">which</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnSettings</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">settings</span><span class="p">.</span><span class="n">settingAt</span><span class="p">(</span> <span class="n">column</span> <span class="p">).</span><span class="n">hint</span><span class="p">().</span><span class="n">size</span><span class="p">(</span> <span class="n">which</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">insertItem</span><span class="p">(</span> <span class="n">QQuickItem</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">insertElement</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">QSizeF</span><span class="p">(),</span> <span class="n">grid</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">insertSpacer</span><span class="p">(</span> <span class="k">const</span> <span class="n">QSizeF</span><span class="o">&amp;</span> <span class="n">spacing</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">insertElement</span><span class="p">(</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">grid</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">removeAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">element</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">minimumGrid</span><span class="p">();</span>

    <span class="k">auto</span><span class="o">&amp;</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">;</span>
    <span class="n">elements</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span> <span class="n">elements</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">index</span> <span class="p">);</span>

    <span class="c1">// doing a lazy recalculation instead ??</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span>
        <span class="o">||</span> <span class="n">grid</span><span class="p">.</span><span class="n">right</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">maxRow</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowSettings</span><span class="p">.</span><span class="n">maxPosition</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">maxColumn</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnSettings</span><span class="p">.</span><span class="n">maxPosition</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">element</span> <span class="o">:</span> <span class="n">elements</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">minimumGrid</span><span class="p">();</span>

            <span class="n">maxRow</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">maxRow</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">bottom</span><span class="p">()</span> <span class="p">);</span>
            <span class="n">maxColumn</span> <span class="o">=</span> <span class="n">qMax</span><span class="p">(</span> <span class="n">maxColumn</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">right</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">maxRow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="o">=</span> <span class="n">maxColumn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">clear</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowSettings</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnSettings</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

    <span class="n">invalidate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">indexAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="o">&amp;&amp;</span> <span class="n">column</span> <span class="o">&lt;</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span> <span class="n">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">effectiveGrid</span><span class="p">(</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QQuickItem</span><span class="o">*</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">itemAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">();</span>

    <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QSizeF</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">spacerAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">spacing</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">QSizeF</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QQuickItem</span><span class="o">*</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">itemAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">itemAt</span><span class="p">(</span> <span class="n">indexAt</span><span class="p">(</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">setGridAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="k">const</span> <span class="n">QRect</span><span class="o">&amp;</span> <span class="n">grid</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">grid</span><span class="p">()</span> <span class="o">!=</span> <span class="n">grid</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">element</span><span class="o">-&gt;</span><span class="n">setGrid</span><span class="p">(</span> <span class="n">grid</span> <span class="p">);</span>
            <span class="n">invalidate</span><span class="p">();</span>

            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">QRect</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">gridAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">grid</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">QRect</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QRect</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">effectiveGridAt</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elementAt</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">effectiveGrid</span><span class="p">(</span> <span class="o">*</span><span class="n">element</span> <span class="p">);</span>

    <span class="k">return</span> <span class="n">QRect</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">invalidateElementCache</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">layoutItems</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">element</span> <span class="o">:</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">item</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">item</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">requiresAdjustment</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">effectiveGrid</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
            <span class="n">layoutItem</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="n">grid</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">transpose</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">element</span> <span class="o">:</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span> <span class="p">)</span>
        <span class="n">element</span><span class="p">.</span><span class="n">transpose</span><span class="p">();</span>

    <span class="n">qSwap</span><span class="p">(</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnSettings</span><span class="p">,</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowSettings</span> <span class="p">);</span>
    <span class="n">qSwap</span><span class="p">(</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span><span class="p">,</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span> <span class="p">);</span>

    <span class="n">invalidate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">effectiveCount</span><span class="p">(</span>
    <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
        <span class="o">?</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">columnCount</span> <span class="o">:</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">rowCount</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">QskGridLayoutEngine</span><span class="o">::</span><span class="n">setupChain</span><span class="p">(</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Orientation</span> <span class="n">orientation</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">QskLayoutChain</span><span class="o">::</span><span class="n">Segments</span><span class="o">&amp;</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">QskLayoutChain</span><span class="o">&amp;</span> <span class="n">chain</span> <span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="cm">/*
        We collect all information from the simple elements first
        before adding those that occupy more than one cell
     */</span>
    <span class="n">QVarLengthArray</span><span class="o">&lt;</span> <span class="k">const</span> <span class="n">Element</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">postponed</span><span class="p">;</span>
    <span class="n">postponed</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">element</span> <span class="o">:</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">elements</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">isIgnored</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">effectiveGrid</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
            <span class="n">grid</span><span class="p">.</span><span class="n">setRect</span><span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">qreal</span> <span class="n">constraint</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">constraints</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">()</span> <span class="p">)</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">qskSegmentLength</span><span class="p">(</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">right</span><span class="p">()</span> <span class="p">);</span>

            <span class="k">auto</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">cell</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">item</span><span class="p">()</span> <span class="p">)</span>
                <span class="n">cell</span><span class="p">.</span><span class="n">hint</span> <span class="o">=</span> <span class="n">layoutHint</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>

            <span class="n">chain</span><span class="p">.</span><span class="n">expandCell</span><span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">top</span><span class="p">(),</span> <span class="n">cell</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">postponed</span> <span class="o">+=</span> <span class="o">&amp;</span><span class="n">element</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">setting</span> <span class="o">:</span> <span class="n">settings</span><span class="p">.</span><span class="n">settings</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">chain</span><span class="p">.</span><span class="n">shrinkCell</span><span class="p">(</span> <span class="n">setting</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">setting</span><span class="p">.</span><span class="n">cell</span><span class="p">()</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span> <span class="n">element</span> <span class="o">:</span> <span class="n">postponed</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">m_data</span><span class="o">-&gt;</span><span class="n">effectiveGrid</span><span class="p">(</span> <span class="o">*</span><span class="n">element</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">::</span><span class="n">Horizontal</span> <span class="p">)</span>
            <span class="n">grid</span><span class="p">.</span><span class="n">setRect</span><span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="p">);</span>

        <span class="n">qreal</span> <span class="n">constraint</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">constraints</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">constraint</span> <span class="o">=</span> <span class="n">qskSegmentLength</span><span class="p">(</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">right</span><span class="p">()</span> <span class="p">);</span>

        <span class="k">auto</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">cell</span><span class="p">(</span> <span class="n">orientation</span> <span class="p">);</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">hint</span> <span class="o">=</span> <span class="n">layoutHint</span><span class="p">(</span> <span class="n">element</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">(),</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">constraint</span> <span class="p">);</span>

        <span class="n">chain</span><span class="p">.</span><span class="n">expandCells</span><span class="p">(</span> <span class="n">grid</span><span class="p">.</span><span class="n">top</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">cell</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<p>Updated on 28 July 2023 at 14:02:30 CEST</p>
